<p-toast key="ToastNotificationChatMessage" position="bottom-right" [preventOpenDuplicates]="true" (onClose)="closeToast()">
    <ng-template let-message #message>
        <div class="grid w-full p-2">

            @for(message of allMessages; track $index){
                <div
                    class="bg-violet-200 rounded border-l-4 border-violet-400 my-2 flex flex-col gap-3 w-full transition-all overflow-hidden relative p-2"
                    (mouseleave)=" message.isOpen = !!message.inputNewMessage?.trim() "
                >

                    <div class="flex gap-2">

                        <div class="w-min">
                            <div class="shadow inset-shadow-sm h-12 w-12 p-2 bg-sky-500 rounded-full text-white font-semibold flex items-center justify-center">MM</div>
                        </div>

                        <div class="flex flex-col justify-center">
                            <div class="text-lg font-semibold">{{ message.conversationName }}</div>
                            <span class="text-2xs"><i>Mensaje:</i> {{ message.message }}</span>
                        </div>

                    </div>
            
                    <div class="px-3 py-1 w-full flex flex-row-reverse">

                        @if(!message.isOpen){

                            <span class="hover:backdrop-brightness-95 px-2 py-1 cursor-pointer" (click)="message.isOpen = true">
                                <strong class="text-xs text-end text-gray-600">Responder</strong>
                            </span>

                        }@else{

                            <div class="ring ring-violet-500 rounded flex w-full">
                                <input
                                    [(ngModel)]=" message.inputNewMessage "
                                    type="text"
                                    class="bg-gray-50 rounded px-2 w-full outline-none text-gray-800 placeholder:text-gray-400"
                                    placeholder="Responder mensaje"
                                    (keydown.enter)=" sendNewMessage( message ) "
                                >
                                <button
                                    class="bg-violet-500 p-2 flex justify-center items-center text-white hover:bg-violet-600 cursor-pointer"
                                    (click)=" sendNewMessage( message ) "
                                >
                                    <svg width="1em" height="1em" viewBox="0 0 14 14"><path fill="currentColor" fillRule="evenodd" d="M11.821.098a1.62 1.62 0 0 1 2.077 2.076l-3.574 10.712a1.62 1.62 0 0 1-1.168 1.069a1.6 1.6 0 0 1-1.52-.434l-1.918-1.909l-2.014 1.042a.5.5 0 0 1-.73-.457l.083-3.184l7.045-5.117a.625.625 0 1 0-.735-1.012L2.203 8.088l-1.73-1.73a1.6 1.6 0 0 1-.437-1.447a1.62 1.62 0 0 1 1.068-1.238h.004z" clipRule="evenodd"/></svg>
                                </button>
                            </div>

                        }

                    </div>



                    <div class="absolute top-1 right-1 flex gap-0.5 justify-center items-center">
                        
                        <a
                            [routerLink]="['/chatApp', getIdByConversationName(message.conversationName) ]"
                            target="_blank"
                            (click)=" closeMe( message.conversationName )"
                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:backdrop-brightness-95"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                                <path fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 4H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-4m-8-2l8-8m0 0v5m0-5h-5"/>
                            </svg>
                        </a>

                        <span
                            (click)=" closeMe( message.conversationName ) "
                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:backdrop-brightness-95"
                        >
                            <svg class="" width="22" height="22" viewBox="0 0 16 16">
                                <path fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="m11.25 4.75l-6.5 6.5m0-6.5l6.5 6.5"/>
                            </svg>
                        </span>
                    </div>
                </div>
            }

        </div>
    </ng-template>
</p-toast>