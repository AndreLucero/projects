<div class="h-full flex flex-col justify-center items-center gap-10 shadow">

    <h2 class="text-4xl capitalize">Iniciar nueva conversación</h2>

    <div class="w-1/3">
        <input
            autofocus
            tabindex="1"
            type="text"
            placeholder="Nombre de la Conversación"
            class="w-full bg-white py-3 px-5 outline-0 rounded-full drop-shadow-md placeholder:text-gray-400 focus-within:drop-shadow-[0px_0px_4px] focus-within:drop-shadow-violet-400"
            [(ngModel)]="inputConversationName"
        >
    </div>
    

    <div class="w-1/3 relative">

        <div class="flex drop-shadow-md focus-within:drop-shadow-[0px_0px_4px] focus-within:drop-shadow-violet-400">
            <input
                tabindex="2"
                type="text"
                class="h-full w-full py-3 px-5 outline-0 rounded-s-full bg-white placeholder:text-gray-400"
                placeholder="Agregar Usuario"
                [(ngModel)]="inputAddUser"
                (focus)=" inputaddUserFocus = true "
                (blur)=" inputaddUserFocus = false "
            >
            <button (click)="addUserToList()" class="bg-violet-500 px-3 text-white cursor-pointer rounded-e-full hover:bg-violet-600 hover:scale-110">
                <svg width="22px" height="22px" viewBox="0 0 24 24"><path fill="currentColor" d="M12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m1 5h-2v4H7v2h4v4h2v-4h4v-2h-4z"/></svg>
            </button>
        </div>

        <div
            class=" flex-col my-2 overflow-auto max-h-40 absolute w-[90%] bg-white left-5 z-10 shadow-xl rounded active:visible
                    [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300
                "
            [class]="inputaddUserFocus ? 'visible': 'invisible'"
            
        >
        @if( allUsers ){
            @for (user of allUsers; track $index) {
                @if( user.id !== chatService.currentUserId && !showUserInTable(user.id) && matchWithInput( user.nombre + user.id ) ){
                    <div class="flex p-2 gap-2 bg-white ring ring-gray-300 cursor-pointer hover:bg-gray-100" (click)="hasClicked(user.id)">

                        @if( user.avatar; as avatar){
                            <img 
                                [src]="`assets/img/avatars/${avatar}`"
                                [alt]="avatar"
                                class="rounded-full size-10"
                            >
                        }@else {
                            <div
                                class="h-10 w-10 p-2  rounded-full text-white font-semibold flex items-center justify-center"
                                [class]="`bg-${ user?.color ?? 'gray' }-500`"
                            >{{ user.alias }}</div>
                        }
                        

                        <div class="grid text-sm text-gray-500">
                            <span>{{user.nombre}}</span>
                            <span class="text-[10px]">{{user.id}}</span>
                        </div>

                    </div>
                }
            }
        }
        </div>

    </div>

    <div class="w-1/3 bg-white rounded p-3 drop-shadow-md focus-within:drop-shadow-[0px_0px_4px]">
        @for(user of selectedUsers; track $index){
            <div class="relative flex p-2 gap-2 bg-white ring ring-gray-300 cursor-pointer hover:bg-gray-100 select-none" (dblclick)="deleteUserFromList(user.id)">

                @if( user.avatar; as avatar){
                    <img 
                        [src]="`assets/img/avatars/${avatar}`"
                        [alt]="avatar"
                        class="rounded-full size-10"
                    >
                }@else {
                    <div
                        class="h-10 w-10 p-2  rounded-full text-white font-semibold flex items-center justify-center"
                        [class]="`bg-${ user?.color ?? 'gray' }-500`"
                    >{{ user.alias }}</div>
                }

                <div class="grid text-sm text-gray-500">
                    <span>{{user.nombre}}</span>
                    <span class="text-[10px]">{{user.id}}</span>
                </div>

                <span
                    (click)="deleteUserFromList(user.id)"
                    class="absolute right-2"
                >
                    <svg class="hover:bg-gray-200" width="18" height="18" viewBox="0 0 16 16">
                        <path fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="m11.25 4.75l-6.5 6.5m0-6.5l6.5 6.5"/>
                    </svg>
                </span>
            </div>
        }@empty {
            <p class="text-gray-300 text-center">No hay usuarios agregados</p>
        }
    </div>

    <div class="w-1/2 flex flex-row-reverse">
        <button
            #btnIniciaChat
            tabindex="3"
            class="flex gap-1 items-center rounded-full py-2 px-4 bg-violet-500 cursor-pointer hover:bg-violet-600 text-white active:scale-95"
            (click)="validateSendData()"
        >
            <span>Iniciar Chat</span>
            <!-- <svg width="18" height="18" viewBox="0 0 26 26"><path fill="currentColor" d="M10 0C4.547 0 0 3.75 0 8.5c0 2.43 1.33 4.548 3.219 6.094a4.8 4.8 0 0 1-.969 2.25a14 14 0 0 1-.656.781a2.5 2.5 0 0 0-.313.406c-.057.093-.146.197-.187.407s.015.553.187.812l.125.219l.25.125c.875.437 1.82.36 2.688.125c.867-.236 1.701-.64 2.5-1.063S8.401 17.792 9 17.469c.084-.045.138-.056.219-.094C10.796 19.543 13.684 21 16.906 21c.031.004.06 0 .094 0c1.3 0 5.5 4.294 8 2.594c.1-.399-2.198-1.4-2.313-4.375c1.957-1.383 3.22-3.44 3.22-5.719c0-3.372-2.676-6.158-6.25-7.156C18.526 2.664 14.594 0 10 0m0 2c4.547 0 8 3.05 8 6.5S14.547 15 10 15c-.812 0-1.278.332-1.938.688s-1.417.796-2.156 1.187c-.64.338-1.25.598-1.812.781c.547-.79 1.118-1.829 1.218-3.281l.032-.563l-.469-.343C3.093 12.22 2 10.423 2 8.5C2 5.05 5.453 2 10 2"/></svg> -->
            <svg width="18" height="18" viewBox="0 0 16 16"><path fill="currentColor" fillRule="evenodd" d="M14.7 12a.376.376 0 0 0 .49-.5l-1.22-2.69c1.23-.773 2-2.04 2-3.91c0-3.48-2.69-4.87-6-4.87C7.28.03 5 .948 4.24 3.16q.844-.13 1.73-.128c1.77 0 3.51.37 4.83 1.32c1.37.987 2.17 2.52 2.17 4.55c0 .76-.113 1.45-.325 2.07l2.05 1.03zM2.9 13.23a1 1 0 0 0-.378-1.26c-.923-.58-1.54-1.52-1.54-3.06c0-1.45.538-2.35 1.34-2.93c.853-.616 2.12-.943 3.66-.943s2.8.327 3.66.943c.804.58 1.34 1.49 1.34 2.93s-.538 2.35-1.34 2.93c-.853.616-2.12.943-3.66.943q-.13 0-.257-.003a1 1 0 0 0-.472.105l-2.85 1.42l.49-1.08zM.84 15.92a.375.375 0 0 0 .416.082l4.45-2.22q.14.004.281.004c3.31 0 6-1.39 6-4.88c0-3.48-2.69-4.87-6-4.87s-6 1.39-6 4.87c0 1.87.774 3.14 2 3.91l-1.22 2.69a.38.38 0 0 0 .073.418z" clipRule="evenodd"/></svg>
        </button>        
        
    </div>
    
</div>

<p-toast key="ToastHolder" />